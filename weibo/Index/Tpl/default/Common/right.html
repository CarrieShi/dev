<div id="right">
    <div class="edit_tpl"><a href="" class='set_model'></a></div> 
<userinfo id='$_SESSION["uid"]'>
    <php>
        $where = array('uid' => session('uid'));
        $field = array('username', 'face80' => 'face', 'follow', 'fans', 'weibo', 'weibo', 'uid');
        $userinfo = M('userinfo')->where($where)->field($field)->find();
    </php>
    <dl class="user_face">
        <dt>
            <a href="{:U('/' . $userinfo['uid'])}">
                <img src="<if condition='$userinfo.face'>__ROOT__/Uploads/Face/{$userinfo.face}<else/>__PUBLIC__/Images/noface.gif</if>" width='80' height='80' alt="{$username}" />
            </a>
        </dt>
        <dd>
            <a href="{:U('/' . $userinfo['uid'])}">{$userinfo.username}</a>
        </dd>
    </dl>
    <ul class='num_list'>
        <li><a href="{:U('follow/' . $userinfo['uid'])}"><strong>{$userinfo.follow}</strong><span>关注</span></a></li>
        <li><a href="{:U('fans/' . $userinfo['uid'])}"><strong>{$userinfo.fans}</strong><span>粉丝</span></a></li>
        <li class='noborder'>
            <a href="{:U('/' . $userinfo['uid'])}"><strong>{$userinfo.weibo}</strong><span>微博</span></a>
        </li>
    </ul>
</userinfo>
    <div class="maybe">
        <fieldset>
            <php>
                $db = M('follow');
                $where = array('fans' => session('uid'));
                $follow = $db->where($where)->field('follow')->select();

                foreach ($follow as $k => $v) {
                    $follow[$k] = $v['follow'];
                }
                
                $sql = 'SELECT uid, username, face50 AS face, COUNT(f.follow) AS `count`
                        FROM hd_follow f LEFT JOIN hd_userinfo u ON u.uid = f.follow
                        WHERE f.fans IN ('. implode(',', $follow) .') /*我关注的ID-->关注的用户*/
                            AND f.follow NOT IN ('. implode(',', $follow) .') /*而不是关注 我关注的ID 的用户*/
                            AND f.follow <> '. session('uid') .' /*也不是我关注的其他用户*/
                        GROUP BY uid
                        ORDER BY `count` DESC LIMIT 4';

                $friend = $db->query($sql);

                //echo $db->getLastSql();
            </php>
            <legend>可能感兴趣的人</legend>
            <ul>
                <maybe uid='$_SESSION["uid"]'>
                    <foreach name='friend' item='v'>
                    <li>
                        <dl>
                            <dt>
                                <a href="{:U('/' . $v['uid'])}">
                                    <img src="<if condition='$v.face'>__ROOT__/Uploads/Face/{$v.face}<else/>__PUBLIC__/Images/noface.gif</if>" width='30' height='30'/>
                                </a>
                            </dt>
                            <dd><a href="{:U('/' . $v['uid'])}">{$result.username}</a></dd>
                            <dd>共{$v.count}个共同好友</dd>
                        </dl>
                        <span class='heed_btn add-fl' uid='{$v.uid}'><strong>+&nbsp;</strong>关注</span>
                    </li>
                    </foreach>
                </maybe>
            </ul>
        </fieldset>
    </div>
    <div class="post">
        <div class='post_line'>
            <span>公告栏</span>
        </div>
        <ul>
            <li><a href="">后盾网DIV+CSS视频教程</a></li>
            <li><a href="">后盾网PHP视频教程</a></li>
            <li><a href="">后盾网MySQL视频教程</a></li>
        </ul>
    </div>
</div>